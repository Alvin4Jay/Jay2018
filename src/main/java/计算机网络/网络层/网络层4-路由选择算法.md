# 路由选择算法

​	**路由选择的工作是确定从发送方到接收方通过路由器网络的好路径(等价为路由)。**

​	主机通常直接与一台路由器相连接，该路由器为该主机的默认路由器，又称为**该主机的第一跳路由器**。每当主机发送一个分组，该分组被传送到它的默认路由器。源主机的默认路由器称为源路由器，目的主机的默认路由器称为目的路由器。**一个分组从源主机到目的主机的路由选择问题可以归结为从源路由器到目的路由器的路由选择问题**。

​	因此，**路由选择算法的目的是给定一组路由器以及连接路由器的链路，路由选择算法要找到一条从源路由器到目的路由器的好路径。**通常，一条好路径指具有**最低费用**的路径。

​	路由选择算法有如下几种分类方式：

1.按照算法是**全局式的还是分散式**的，可分为

- **全局式路由选择算法**。用完整的、全局性的网络知识计算出源到目的地之间的最低费用路径。该算法以所有节点之间的连通性及所有链路的费用作为输入。这要求算法在开始计算之前，要以某种方式获取这些信息。因此，该算法具有关于连通性和链路费用方面的完整信息。实践中，这种具有全局状态信息的算法称为**链路状态算法**。
- **分散式路由选择算法**。以**迭代、分布式**的方式计算出最低费用路径。没有节点拥有关于所有网络链路费用的完整信息，每个节点仅有与其直接相连链路的费用知识即可开始工作。并通过迭代计算过程与相邻节点交换信息，一个节点逐渐计算出到达某目的节点或一组节点的最低费用路径。其中一种算法为**距离向量算法**，每个节点维护到网络中所有其他节点的费用估计的向量。

2.按照算法是**静态的还是动态**的，可分为

- **静态路由选择算法**。路由的变化十分缓慢，通常是人工干预进行调整。
- **动态路由选择算法**。能够<u>当网络流量负载或拓扑发生变化时改变路由选择路径</u>。

3.按照是**负载敏感还是负载迟钝**，可分为

- **负载敏感**算法。链路费用会动态地变化以反映出底层链路的当前拥塞水平。
- **负载迟钝**算法。链路费用不明显地反映其当前的拥塞水平。

## 一、链路状态路由选择算法(LS)

​	在该算法中，**网络拓扑和所有的链路费用已知**。实践中这是通过让每个节点向网络中所有其他节点广播链路状态分组来完成的，其中每个链路状态分组包含他所连接的链路的特征和费用。节点广播的结果是所有节点具有了该网络的等同、完整的视图。

## 二、距离向量路由选择算法(DV)

​	该算法是一种**迭代的、异步的和分布式**的算法。首先它是分布式的，每个节点从一个或多个直接相连的邻居接受某些信息，执行计算，然后将结果分发给邻居。其次，它是迭代的，因为此过程一直持续到邻居之间无更多信息要交换为止。最后它是异步的，因为它不要求所有节点相互之间步伐一致的操作。

​	节点具有的唯一信息是它到直接相连邻居的链路费用和它从这些邻居接收到的信息。

## 三、层次路由选择

​	在LS和DV路由算法中，我们将网络只看作是一个互联路由器的集合。所有路由器执行相同的路由选择算法，以计算穿越整个网络的路由选择路径。这种模型有以下问题：

- **规模**。随着路由器数目的增大，涉及路由选择信息的计算、存储及通信的开销将高得不可实现。因此，必须采取措施以减少公共因特网这种大网络中的路由选择计算的复杂性。
- **管理自治**。理想情况下，一个组织应当能够按照自己的意愿运行和管理其网络，还要能将其网络与其他外部网络连接。

​        以上的问题可通过将路由器组织进**自治系统(AS)**来解决，**每个AS由一组通常处于相同管理控制之下的路由器组成。**在相同的AS中的路由器运行同样的路由选择算法，且拥有彼此的信息。在一个自治系统内部运行的路由选择算法称为**自治系统内部路由选择协议**。此外，将自治系统彼此互联是必须的，因此一个AS中的一台或多台路由器将有另外的任务，即负责向本AS之外的目的地转发分组，这些路由器称为**网关路由器**。

​	存在一种情况是源AS具有两条或更多的链路通向外部AS，这种端到端的路由选择需要源AS从相邻AS获取可达性信息和向该AS中所有路由器传播可达性信息，这由**自治系统间路由选择协议**完成。

## 四、因特网中的路由选择

### 1.因特网中自治系统内部的路由选择：RIP

​	AS内部路由选择协议用于确定在一个AS内部执行路由选择的方式，AS内部路由选择协议又称为**内部网关协议**。广泛应用的自治系统内部路由选择协议**是路由选择信息协议(RIP)和开发最短路优先(OSPF)**。

​	RIP是一种**距离向量协议**，使用跳数作为其费用的测度，即每条链路费用为1。在RIP中，费用指从源路由器到目的子网的统计。**RIP使用跳，跳是沿着从源路由器到目的子网(包括目的子网)的最短路径所经过的子网数量**。

​	任何一台路由器的距离向量是从这台路由器到该AS中子网的最短路径距离的当前估计值。在RIP中，路由选择更新信息在邻居之间通过使用一种**RIP响应报文**进行交换。由一台路由器或主机发出的响应报文包含了一个该AS内部的多达25个子网的列表，以及发送方到其中每个子网的距离。

### 2.因特网中自制系统内部的路由选择：OSPF

​	OSPF也被用于AS内部路由选择，**核心是一个使用洪泛链路状态信息的链路选择协议和一个Dijkstra最低费用路径算法**。使用OSPF，一台路由器构建了一幅关于整个自治系统的完整拓扑图；并向自治系统内部所有其他路由器广播路由选择信息。该协议具有安全、允许具有多条相同费用的路径、支持单播和多播的路由选择、支持单个路由选择域内的层次结构等特点。

​	一个OSPF自治系统可以配置成多个区域。每个区域运行自己的OSPF链路状态路由选择算法，一个区域内的每台路由器都向该区域内的所有其他路由器广播其链路状态。在一个区域内，一台或多台区域边界路由器负责为流向该区域以外的分组提供路由选择。最后，在AS中只有一个区域可以配置成主干区域，该主干区域的作用是为AS内其他区域之间的流量提供路由选择。

### 3.自治系统间的路由选择：BGP(p262-268)

​	跨越多个AS的源和目的对之间的路由选择由**边界网关协议(BGP)**支持。BGP为每个AS提供了进行工作的以下手段：①从相邻AS处获得子网的可达性信息；②向本AS内部的所有路由器传播这些可达性信息；③基于可达性信息和AS策略，决定到达子网的好路由。  更为重要的是，BGP使得每个子网向因特网的其余部分通告他的存在。

​	在BGP中，路由器对通过使用179端口的半永久TCP连接来交换路由选择信息。位于该TCP连接端点的两台路由器称为BGP对等方，沿着该连接发送所有BGP报文的TCP连接称为BGP会话。**跨越两个AS的BGP会话称为外部BGP(eBGP)，在同一AS中的两台路由器之间的BGP会话称为内部BGP会话(iBGP)。**

![](http://pbku1z6p0.bkt.clouddn.com/4-19.png)

## 五、广播和多播路由选择

​	前面关注的是支持单播(点对点)通信的路由选择协议，单个源节点基于这种协议向单个目的节点发送分组。以下关注广播和多播路由选择。**在广播路由选择中，网络层提供了从一种源节点到网络中的所有其他节点交付分组的服务；多播路由选择使单个源节点能够向其他网络节点的一个子集发送分组的副本。**

### 1.广播路由选择算法(Broadcast)

​	完成广播通信有两种方式，**源复制和网络中复制**两种。源复制指在给定N个目的节点的情况下，源节点产生该分组的N份副本，对不同目的地的每个分组进行编址，并用单播路由选择向N个目的地传输N份副本(N次单播)。这种方式效率比较低，如果源节点经过单一链路与该网络其余部分相连，该相同分组的N份独立的副本将都经过该段链路传输。更为有效的方式是，**经第一跳仅发送分组的单个副本，由第一跳后面的其他端的节点生产并转发任何附加的所需副本**。如下图所示：

![](http://pbku1z6p0.bkt.clouddn.com/4-20.png?imageMogr2/auto-orient/thumbnail/x350/blur/1x0/quality/75|imageslim)

  										  源复制和网络中复制	

​	N次单播实现的广播具有一些缺点，但网络节点本身在分组复制、分组转发和广播路由计算中起的积极作用显然是十分重要的。主要有以下几种方法：

#### (1)无控制洪泛

​	这是实现广播最方便的技术，该方法要求源节点向它的所有邻居发送分组的副本，当某节点接收到了一个广播分组时，他复制分组并向他的所有邻居转发。这种方式有可能导致**广播风暴**(图中具有环的情况)。

#### (2)受控洪泛

​	避免广播风暴的关键是每个节点明智的选择何时洪泛分组，何时不洪泛分组。有如下几种方式解决；

- 序号控制洪泛。源节点将其地址和广播序号放入广播分组，再向他的邻居发送该分组。每个节点维护它已经收到的、复制的和转发的源地址和每个广播分组的序号列表。当节点接收到一个广播分组时，首先检查该分组是否在列表中。如果在，就丢弃该分组；不在，复杂该分组并向该节点的邻居转发。
- 反向路径转发(RPF)。思路是当一台路由器接收到具有给定源地址的广播分组时，仅当该分组到达的链路正好是位于它自己的返回其源的最短单播路径上，他才向其所有出链路传输报文；否则，路由器只是丢弃该分组。

#### (3)生成树广播

​	虽然序号控制洪泛和RPF避免了广播风暴，但它们不能完全避免冗余广播分组的传输。生成树广播能够保证不会产生冗余的广播分组。因此提供广播的另一种方式是**首先对网络节点构造出一颗生成树，当源节点要发送一个广播分组时，它向所有属于该生成树的特定链路发送该分组。接收广播分组的节点则向在生成树中的所有邻居转发分组。**生成树不仅消除了冗余的广播分组，而且一旦合适，该生产树可用于任何节点的广播分组。

### 2.多播(Multicast)

​	多播服务下，多播分组仅被交付给网络节点中的一个子集。该服务应用在批量数据传输、数据共享应用等。

​	在多播通信中，有两个重要的问题，即如何标识多播分组的接收方，以及如何为发送到这些接收方的分组编址。在因特网体系结构中，多播数据报使用**间接地址**编址。即**用一个标识表示一组接收方，寻址到该组的分组副本被交付给所有与该组相关联的多播接收方，且该组使用一个单一标识符。在因特网中，这种表示一组接收方的单一标识是一类D类多播地址。**与一个D类地址相关联的接收方小组被称为一个多播组。

​	多播组使用因特网组管理协议(IGMP)进行管理。

#### (1)因特网组管理协议

​	IGMP协议运行在一台主机和与其直接相连的路由器之间(第一跳路由器)。如下图所示。

![](http://pbku1z6p0.bkt.clouddn.com/4-21.png?imageMogr2/auto-orient/thumbnail/x350/blur/1x0/quality/75|imageslim)

​												IGMP与多播路由选择协议

​	IGMP为一台主机提供了一个手段，让它通知与其相连的路由器：在本主机上运行的一个应用程序想加入一个特定的多播组。由于IGMP的交互范围限于主机与与其相连的路由器之间，因此遍及互联网内的多播路由器之间的协调由多播路由选择协议完成，以便多播数据报能路由到其最终的目的地。因此，**网络层中的多播由IGMP与多播选择协议支持。**

​	IGMP协议有三种报文类型，membership_query、membership_report，leave_group三种。

#### (2)多播路由选择算法

​	多播路由选择的目的是发现一棵链路的树，这些链路连接了所有具有属于该多播组的相连主机的路由器。于是，多播分组能沿着这棵树从发送方路由到所有属于该多播树的主机。

​	实践中采用两种方式确定多播路由选择树。**一是使用一颗组共享树的多播路由选择；二是使用一个基于源的树的多播路由选择。**

####(3)因特网中的多播路由选择

​	如距离向量多播路由选择协议(DVMRP)，实现了具有反向路径转发与剪枝算法的基于源的树；又如协议无关的多播路由选择协议。